---
- hosts: localhost
  gather_facts: false
  vars_files:
    - vars/check_logs.yml

  tasks:
    - name: Add hosts from vars file
      add_host:
        name: "{{ item.instance }}"
        groups: from_vars
        log_paths: ["{{ item.path }}"]
      loop: "{{ servers }}"

- hosts: from_vars
  gather_facts: false
  become: true
  tasks:
    - name: Check if log file exists
      stat:
        path: "{{ item }}"
      loop: "{{ log_paths }}"
      register: st

    - name: Show result
      debug:
        msg: |
          {{ inventory_hostname }}
          existing: {{ st.results | selectattr('stat.exists') | map(attribute='invocation.module_args.path') | list }}
          missing : {{ st.results | rejectattr('stat.exists') | map(attribute='invocation.module_args.path') | list }}
