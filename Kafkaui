{
  "__inputs": [
    {
      "name": "DS_PROMETHEUS",
      "label": "Prometheus",
      "description": "",
      "type": "datasource",
      "pluginId": "prometheus",
      "pluginName": "Prometheus"
    }
  ],
  "title": "Kafbat UI (Actuator/Prometheus)",
  "timezone": "browser",
  "editable": true,
  "schemaVersion": 38,
  "version": 1,
  "tags": ["kafbat","kafka-ui","spring","actuator"],
  "refresh": "30s",
  "time": { "from": "now-6h", "to": "now" },
  "panels": [
    {
      "type": "stat",
      "title": "Uptime (h)",
      "gridPos": {"x": 0,"y": 0,"w": 4,"h": 4},
      "options": {"reduceOptions":{"calcs":["lastNotNull"]},"orientation":"horizontal","textMode":"auto"},
      "targets":[{ "expr":"process_uptime_seconds/3600", "refId":"A", "datasource":{"type":"prometheus","uid":"${DS_PROMETHEUS}"} }]
    },
    {
      "type": "stat",
      "title": "Ready Time (s)",
      "gridPos": {"x": 4,"y": 0,"w": 4,"h": 4},
      "options": {"reduceOptions":{"calcs":["lastNotNull"]}},
      "targets":[{ "expr":"application_ready_time_seconds{main_application_class=\"io.kafbat.ui.KafkaUiApplication\"}", "refId":"A", "datasource":{"type":"prometheus","uid":"${DS_PROMETHEUS}"} }]
    },
    {
      "type": "stat",
      "title": "Started Time (s)",
      "gridPos": {"x": 8,"y": 0,"w": 4,"h": 4},
      "options": {"reduceOptions":{"calcs":["lastNotNull"]}},
      "targets":[{ "expr":"application_started_time_seconds{main_application_class=\"io.kafbat.ui.KafkaUiApplication\"}", "refId":"A", "datasource":{"type":"prometheus","uid":"${DS_PROMETHEUS}"} }]
    },
    {
      "type": "stat",
      "title": "Disk Free (%)",
      "gridPos": {"x": 12,"y": 0,"w": 4,"h": 4},
      "options": {"reduceOptions":{"calcs":["lastNotNull"]}},
      "targets":[
        {
          "expr":"100 * disk_free_bytes{path=\"/.\"} / disk_total_bytes{path=\"/.\"}",
          "refId":"A",
          "datasource":{"type":"prometheus","uid":"${DS_PROMETHEUS}"}
        }
      ],
      "fieldConfig":{"defaults":{"unit":"percent"},"overrides":[]}
    },
    {
      "type": "stat",
      "title": "CPU (process)",
      "gridPos": {"x": 16,"y": 0,"w": 4,"h": 4},
      "options": {"reduceOptions":{"calcs":["lastNotNull"]}},
      "targets":[{ "expr":"process_cpu_usage", "refId":"A", "datasource":{"type":"prometheus","uid":"${DS_PROMETHEUS}"} }],
      "fieldConfig":{"defaults":{"unit":"percentunit"}}
    },

    {
      "type": "timeseries",
      "title": "HTTP Requests /s by Status",
      "gridPos": {"x": 0,"y": 4,"w": 12,"h": 8},
      "fieldConfig":{"defaults":{"unit":"req/s"}},
      "targets":[
        {
          "expr":"sum by (status) (rate(http_server_requests_seconds_count[1m]))",
          "legendFormat":"{{status}}",
          "refId":"A",
          "datasource":{"type":"prometheus","uid":"${DS_PROMETHEUS}"}
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "HTTP Avg Latency (s)",
      "gridPos": {"x": 12,"y": 4,"w": 8,"h": 8},
      "targets":[
        {
          "expr":"sum(rate(http_server_requests_seconds_sum[1m])) / sum(rate(http_server_requests_seconds_count[1m]))",
          "legendFormat":"avg",
          "refId":"A",
          "datasource":{"type":"prometheus","uid":"${DS_PROMETHEUS}"}
        }
      ]
    },

    {
      "type": "bargauge",
      "title": "Top URIs by Request Rate",
      "gridPos": {"x": 0,"y": 12,"w": 10,"h": 7},
      "options":{"orientation":"horizontal","displayMode":"gradient"},
      "targets":[
        {
          "expr":"topk(10, sum by (uri) (rate(http_server_requests_seconds_count[1m])))",
          "legendFormat":"{{uri}}",
          "refId":"A",
          "datasource":{"type":"prometheus","uid":"${DS_PROMETHEUS}"}
        }
      ],
      "fieldConfig":{"defaults":{"unit":"req/s"}}
    },
    {
      "type": "bargauge",
      "title": "Client Errors 4xx by URI (5m)",
      "gridPos": {"x": 10,"y": 12,"w": 10,"h": 7},
      "options":{"orientation":"horizontal","displayMode":"gradient"},
      "targets":[
        {
          "expr":"topk(10, sum by (uri) (increase(http_server_requests_seconds_count{outcome=\"CLIENT_ERROR\"}[5m])))",
          "legendFormat":"{{uri}}",
          "refId":"A",
          "datasource":{"type":"prometheus","uid":"${DS_PROMETHEUS}"}
        }
      ]
    },

    {
      "type": "timeseries",
      "title": "JVM Heap Used vs Max",
      "gridPos": {"x": 0,"y": 19,"w": 12,"h": 8},
      "targets":[
        {
          "expr":"sum(jvm_memory_used_bytes{area=\"heap\"})",
          "legendFormat":"heap used",
          "refId":"A",
          "datasource":{"type":"prometheus","uid":"${DS_PROMETHEUS}"}
        },
        {
          "expr":"sum(jvm_memory_max_bytes{area=\"heap\"})",
          "legendFormat":"heap max",
          "refId":"B",
          "datasource":{"type":"prometheus","uid":"${DS_PROMETHEUS}"}
        }
      ],
      "fieldConfig":{"defaults":{"unit":"bytes"}}
    },
    {
      "type": "stat",
      "title": "Live Threads",
      "gridPos": {"x": 12,"y": 19,"w": 4,"h": 4},
      "options":{"reduceOptions":{"calcs":["lastNotNull"]}},
      "targets":[{ "expr":"jvm_threads_live_threads", "refId":"A", "datasource":{"type":"prometheus","uid":"${DS_PROMETHEUS}"} }]
    },
    {
      "type": "stat",
      "title": "Daemon Threads",
      "gridPos": {"x": 16,"y": 19,"w": 4,"h": 4},
      "options":{"reduceOptions":{"calcs":["lastNotNull"]}},
      "targets":[{ "expr":"jvm_threads_daemon_threads", "refId":"A", "datasource":{"type":"prometheus","uid":"${DS_PROMETHEUS}"} }]
    },
    {
      "type": "stat",
      "title": "Open FDs",
      "gridPos": {"x": 20,"y": 19,"w": 4,"h": 4},
      "options":{"reduceOptions":{"calcs":["lastNotNull"]}},
      "targets":[{ "expr":"process_files_open_files", "refId":"A", "datasource":{"type":"prometheus","uid":"${DS_PROMETHEUS}"} }]
    },

    {
      "type": "timeseries",
      "title": "Scheduler Tasks /s by Function",
      "gridPos": {"x": 0,"y": 27,"w": 12,"h": 7},
      "targets":[
        {
          "expr":"sum by (code_function) (rate(tasks_scheduled_execution_seconds_count[1m]))",
          "legendFormat":"{{code_function}}",
          "refId":"A",
          "datasource":{"type":"prometheus","uid":"${DS_PROMETHEUS}"}
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Security: Access Denied (rate)",
      "gridPos": {"x": 12,"y": 27,"w": 12,"h": 7},
      "targets":[
        {
          "expr":"rate(spring_security_authorizations_seconds_count{error=\"AccessDeniedException\"}[5m])",
          "legendFormat":"AccessDenied",
          "refId":"A",
          "datasource":{"type":"prometheus","uid":"${DS_PROMETHEUS}"}
        }
      ]
    }
  ]
}
