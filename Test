{# Bỏ các key sẽ render thủ công: kubelet-arg, service-cidr, cluster-cidr #}
{% set cfg_wo = (cfg_merged | dict2items
                 | rejectattr('key','in',['kubelet-arg','service-cidr','cluster-cidr'])
                 | items2dict) %}

{{ cfg_wo | to_nice_yaml(indent=2) | trim }}

{# ép quote cho cluster-cidr và service-cidr nếu tồn tại #}
{% if cfg_merged.get('cluster-cidr') is defined %}
cluster-cidr: "{{ cfg_merged['cluster-cidr'] | replace('"','\"') }}"
{% endif %}
{% if cfg_merged.get('service-cidr') is defined %}
service-cidr: "{{ cfg_merged['service-cidr'] | replace('"','\"') }}"
{% endif %}

kubelet-arg:
{% for a in cfg_merged['kubelet-arg'] | default([]) %}
  - "{{ a | replace('"','\"') }}"
{% endfor %}
