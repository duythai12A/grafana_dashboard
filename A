DATA_DIR="/u01/app/rke2"

sudo systemctl stop rke2-agent || true
sudo systemctl disable rke2-agent || true

sudo rm -f /etc/systemd/system/rke2-agent.service
sudo rm -f /etc/systemd/system/multi-user.target.wants/rke2-agent.service
sudo rm -f /usr/local/bin/rke2* /usr/bin/rke2* /var/lib/rancher/rke2/bin/* 2>/dev/null || true

sudo rm -rf ${DATA_DIR} /etc/rancher/rke2 /etc/rancher /var/lib/kubelet
sudo rm -rf /var/lib/rancher/rke2  # nếu từng dùng mặc định

sudo rm -rf /etc/cni /opt/cni /var/lib/cni /run/flannel 2>/dev/null || true
sudo rm -rf /var/run/cilium /sys/fs/bpf/tc/globals 2>/dev/null || true

sudo ip link del cni0 2>/dev/null || true
sudo ip link del flannel.1 2>/dev/null || true
sudo ip link del cilium_host 2>/dev/null || true
sudo ip link del cilium_net 2>/dev/null || true
sudo ip link del cilium_vxlan 2>/dev/null || true

sudo systemctl daemon-reload
